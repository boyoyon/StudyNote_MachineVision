<!doctype html>
<html lang="ja">
    <head>
        <script type="text/javascript" id="MathJax-script" async
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
        <meta charset="utf-8" />
        <title>領域</title>
        <style type="text/css">
            p
            {
                padding-left: 2em;
            }
            .margin-large
            {
                margin-left: 30px;
            }
           .margin-abstract {
               margin-left: 60px; /* 左マージンを広くする */
               margin-right: 60px; /* 右マージンを広くする */
           }
        </style>
    <style>
        .two-columns {
            display: flex;
            flex-direction: row;
            gap: 20px; /* 列間のスペース */
        }
        .column {
            flex: 1; /* 各列が均等に幅を取る */
        }
    </style>
<style>
.three-columns {
  display: flex;
  gap: 10px; /* 列間の余白を設定 */
}
.column {
  flex: 1; /* 各列の幅を均等にする */
  padding: 10px; /* 内側の余白を設定 */
}
</style>
    <style>
        .styleRef { 
            text-indent: -40px; /* 最初の行の字下げを逆方向に */
            margin-left: 10px; /* 2行目以降の字下げを調整 */
            ul {
                  list-style-type: none; /* 箇条書き記号を非表示 */
                  padding-left: 40px; /* 全体の左余白 */
            }
            li {
            }
        }
    </style>
    <style>
        .styleBullet { 
            text-indent: -20px; /* 最初の行の字下げを逆方向に */
            margin-left: 30px; /* 2行目以降の字下げを調整 */
            ul {
                  list-style-type: none; /* 箇条書き記号を非表示 */
                  padding-left: 0px; /* 全体の左余白 */
            }
            li {
            }
        }
    </style>
    <style>
            ol
            {
                margin-left: 30px;
            }
            ul
            {
                margin-left: 30px;
            }
    </style>
    </head>
    <body>
        <h1><center>3章 領域</center></h1>
<p>
画像内の領域とは類似した性質を持つ連結したピクセルのグループである。領域は場面内のオブジェクトに対応している可能性があるので、画像の解釈にとって重要である。画像には幾つかのオブジェクトが含まれているかも知れないし、更にオブジェクトには幾つかの領域が含まれていてオブジェクトの個々の部分に対応しているかも知れない。画像を正確に解釈するためには、オブジェクトやオブジェクトの各部が領域に分割されなければならない。しかし領域分割誤り(segmentation errors)のために領域とオブジェクトの対応は完全ではなく、画像解釈の後の工程でオブジェクト特有の知識を使わなければならない。
</p>
<h2>3.1  領域(Regions)とエッジ(Edges)</h2>
<p>
図3.1に示す簡単な画像を考えよう。この図には幾つかのオブジェクトが含まれている。画像の解析と理解の第1ステップは、異なるオブジェクトを表現している領域を明確に区別する様に分割する事である。この様な分割は画像内のピクセルのグレイ値の特性から得られるかも知れない。画像は2次元配列であり、配列の要素はグレイ値だった事を思い出そう。画像配列内の指定されたインデックスのグレイ値であるピクセルが観測結果であり、それ以外の領域構成要素(membership)などの属性はグレイ値から導かれなければならない。画像を領域に分割するには2つの手法がある。領域ベースの分割とエッジ検出を用いた境界推定である。
</p>
<center><img src="images/fig3_1.png"></center>
<p>
図3.1 複数の領域を持つ画像を示す。領域と境界は同じ情報を格納していることに注意。なぜなら一方の表現は他方から導き出すことができるからである。
</p>
<p>
　領域ベースの手法では、オブジェクトに対応する全てのピクセルは一緒にグループ化され、1つの領域に属す事を示す様に印を付けられる。この工程は領域分割(segmentation)と呼ばれる。ピクセルは画像の他の部分と区別する何らかの基準を用いて領域に割り当てられる。分割における最も重要な2つの原理は値の類似性と空間的近接性である。2つのピクセルが類似した輝度特性を持つか、或いは近くにあるならば同じ領域に割り当てられる可能性がある。例えば2ピクセル間の類似性の指定された計量値はグレイ値の差分であったり、空間的近接性の指定計量はユークリッド距離であったりする。領域内のグレイ値の変動や領域のコンパクト性は、それぞれ領域内のピクセルの計量値の類似性、空間的近接性として使うことも出来る。
</p>
<p>
　類似性と近接性の原理は、同じオブジェクトは画像内で空間的に近くて類似したグレイ値のピクセルに投影されると言う仮定に由来している。当然この仮定は多くの状況で満たされない。しかしこの簡単な仮定を使って画像内のピクセルをグループ化することが出来、その後で領域をオブジェクトモデルと照合するために領域依存の知識を使う。単純な状況では領域分割は2章で述べたしきい処理と成分ラベル付けで実現できる。複雑な画像ではオブジェクトの一部に対応する領域にピクセルを割り当てる為にはしきい処理よりも洗練された技法を必要とするかも知れない。
</p>
<p>
　領域分割は漁期境界にあるピクセルを見つけることでも実現できる。エッジと呼ばれるこれらのピクセルは近傍ピクセルを見る事で求めることが出来る。エッジピクセルは境界上にあり、境界の両側の領域は異なるグレイ値を持つ可能性があるので、領域境界は近傍ピクセルを差を測ることにより求めることが出来る。たいていのエッジ検出器はエッジ検出の基礎として輝度特性のみを用いるが、テクスチャや動きといった派生特性も用いられる可能性がある。
</p>
<p>
　理想的な画像では、領域は閉じた輪郭により囲まれる。原理的には領域分割とエッジ検出は同じ結果を生じるべきである。エッジ(閉じた輪郭)は境界追跡アルゴリズムを使って領域から得る事も出来る。同様に領域は領域塗りつぶしアルゴリズムを使ってエッジから得る事も出来る。あいにく現実の画像では領域から正しいエッジを得る事も、その反対も稀である。ノイズやその他の要因のため領域分割もエッジ検出も完璧な情報は与えない。
</p>
<p>
　本章で2つの問題に注目しながら領域の基本概念について述べる。<br>
  ・画像を領域に分割する<br>
  ・領域を表現する<br>
本章は自動しきい処理、領域分割用のヒストグラム法から始めて領域表現の手法へと続く。その後でもっと洗練された領域分割手法を紹介する事になるであろう。エッジ検出手法については5章で述べる。
</p>
<p>
　続く節では領域形成手法について述べる。しきい処理は最も単純な領域分割手法である。しきい処理について述べた後で、輝度特性を使って領域の類似性を判定する方法を紹介する。この方法はしきい処理を用いた初期領域分割の後で適用できるかもしれない。これらのアルゴリズムはオブジェクトやその一部に対応する領域分割を生じるものと期待される。点の運動特性は領域を形成したり仕上げたりするために使う事も出来る。動きを使うことについては14章で述べる。
</p>
<h2>3.2  領域分割(Region Segmentation)</h2>
<p>
参照しやすいように2.1節で定義した領域分割問題をここでもう一度述べる。画像ピクセルの集合 \(\mathcal I\) と均質性条件?(homogeneity predicate) \(P(･)\) が与えられた場合、画像 \(\mathcal I\) を \(n\) 個の領域 \(R_i\) の集合へと分ける分割 \(S\) を見つける。
\[
\bigcup\limits_{i=1}^n R_i=\mathcal I
\]
均質性条件と画像の分割は以下の性質を持つ。どの領域も属性を満たす。全ての \(i\) に対して
\[
P(R_i)=True
\]
隣接するどの2つの領域も、属性を満たす単一の領域に結合することは出来ない。つまり
\[
P(R_i\cup R_j)=False
\]
均質性条件は領域モデルに対する領域 \(R_i\) 内の全ての点の適合性を規定する。
</p>
<p>
  グレイ値画像を2値画像に変化する工程は領域分割の簡単な形であり、そこでは画像は2つの集合に分割される。2値画像を得るためのしきい処理アルゴリズムは2値以上に一般化できる。2章で述べたアルゴリズムにおけるしきい値はシステムの設計者が選んだ。場面の変化に対して領域分割を堅牢にするためには、アルゴリズムは画像内に存在する輝度サンプルを使って適正なしきい値を自動的に選択できる様になっているべきである。オブジェクトのグレイ値に関する知識はアルゴリズムに固定的に組み込むべきではない。アルゴリズムは適正なしきい値を選ぶためにグレイ値の相対特性に関する知識を使うべきである。この簡単なアイディアは多くのコンピュータビジョンアルゴリズムで役に立つ。
</p>
<h3>3.2.1  自動しきい処理 (Automatic Thresholding)</h3>
<p>
領域分割をより堅牢にするため、しきい値はシステムが自動的に選ぶべきである。場面内のオブジェクトやアプリケーション、環境に関する知識は領域分割アルゴリズムの中で固定しきい値よりも一般的な形で使われるべきである。この様な知識としては以下の様なものがある。<br>
・オブジェクトの輝度特性<br>
・オブジェクトのサイズ<br>
・オブジェクトが占有する画像の部分<br>
・画像に現れるオブジェクトのタイプの数<br>
この様な知識を使い、人の介入無しで個々の画像に対して適正なしきい値を選択するしきい処理手法を自動しきい処理手法と呼ぶ。自動しきい処理は通常グレイ値のヒストグラムを使って画像内のグレイ値の分布を解析し、最も適当なしきい値を選ぶためにアプリケーションに関する知識を使う。これらの手法で使われる知識はずっと一般的なので、アルゴリズムの適用可能領域は広がる。
</p>
<p>
  画像は背景を含む \(n\) 個のオブジェクト \(O_1, O_2, ･･･, O_n\) から成り、確率分布 \(p_1(z), ･･･, p_n(z)\) の数(population) \(π_1, ･･･, π_n\) のグレイ値から成ると仮定しよう。多くの応用では画像内にオブジェクトが現れる確率 \(P_1, ･･･, P_n\) は判っている。この知識を使ってしきい値選択問題を厳密に形式化することは可能である。場面の照明幾何が画像内の輝度値の確率分布 \(p_i(z)\) を制御するので、通常はしきい値を予め計算しておく事は出来ない。これから見るように、たいていの自動しきい値選択法はサイズと発生頻度を使い、画像機度のヒストグラムを計算することで輝度分布を推定する。
</p>
<p>
  多くの自動しきい処理手法が異なる応用に使われている。共通する手法の幾つかを次節で述べる。説明を簡単にするため、オブジェクトが暗くて背景が明るいと言う慣例に従う。続く節で紹介するアルゴリズムは以下の様な場合を扱えるように簡単に修正することが出来る。暗い背景に対する明るいオブジェクト、明と暗の背景に対する中間グレイのオブジェクト、中間グレイの背景に対する明と暗のオブジェクト。アルゴリズムのいくつかはピクセル値の任意の集合から取ったオブジェクトグレイ値を扱えるように一般化する事が出来る。
</p>
<p>
<strong>Pタイル法</strong><br>
Pタイル法は画像をしきい処理するために、希望するオブジェクトの面積やサイズの知識を使う。与えられた応用で、オブジェクトが画像面積の \(p%\) を占有すると仮定しよう。この知識を使って入力画像のグレイ値ヒストグラムを分割することにより、オブジェクトにピクセルの \(p％\) を割り当てる1つかそれ以上のしきい値を選ぶ事が出来る。図3.2にこの手法を使って作った2値画像の例を示す。
</p>
<p>
  明らかにこの方法は用途が非常に限られている。一般にはページ読み取りの様な少数の応用でしかこの様な面積の推定は許されない。
</p>
<center><img src="images/fig3_2.png"></center>
<p>
図3.2　ヒストグラムの網掛け部分は、画像領域の \(p％\) を表す。ヒストグラムの \(p％\) が オブジェクトに割り当てられるように閾値は選ばれている
</p>
<p>
<strong>モード法</strong><br>
画像内のオブジェクトが同一のグレイ値で、背景がそれとは異なるグレイ値をとるとし、画像ピクセルは0平均のガウシアンノイズを受けているとするならば、グレイ値はパラメータ \((μ_1,σ_1),(μ_2,σ_2)\) の2つの標準分布から引き出せると仮定できる。そうすると画像のヒストグラムは図3.3に示す様に、離れた2つのピークを持つ。輝度値が一定で、分散 \(σ_1＝σ_2＝0\) の理想的な場合にはヒストグラムは2本のスパイクになり、しきい値はこのスパイクの間のどこかに位置する。実際にはそれほど完全には分離していない。この場合、ヒストグラムからピークと谷を検出し、しきい値は谷に対応するピクセル値に設定されるかも知れない。オブジェクトのサイズと背景のサイズが同じ場合には、このしきい値の選択法によって分類ミスの確率が最小になることを示すことが出来る。たいていの応用ではヒストグラムは谷の近くで密度が低いので、領域分割はしきい値に敏感ではない。
</p>
<center><img src="images/fig3_3.png"></center>
<p>
図3.3　理想的には、背景とオブジェクトの輝度は非常に離れている。理想的な場合には(a)に示す様に、閾値 \(T\) は2つのピークのどこでも良い。たいていの画像では(b)に示す様に輝度はヒストグラム上[背景とオブジェクトが]重なっている
</p>
<p>
  ピークと谷の決定は自明な問題ではない。これを解決する為に多くの方法が提案されている。自動しきい処理手法のためには、ヒストグラム内の点のピーク性(？peakiness)と谷性(？valleyness)の計量を持つべきである。コンピュータ処理的に効率的な方法をアルゴリズム3.1で与える。この方法は、ある最小距離だけ離れた所にあるピークを考慮することにより、局所的なピークを無視する。ピーク性はピークの高さと谷の深さに基づいている。ピークと谷の距離は無視する。
</p>
<p>
<strong>アルゴリズム3.1  適正なしきい値を選択するためのピーク検出</strong>
<div class="styleBullet">
<ul>
<li>1. ある最小距離以上離れた極大をヒストグラム上で探す。それらを \(g_i,g_j\) しよう。</li>
<li>2. ヒストグラム上の \(g_i\) と \(g_j\) の間にある最小点 \(g_k\) を探す。</li>
<li>3.  \(min(H(g_i), H(g_j))/H(g_k)\) で定義されるピーク性を求める。</li>
<li>4. 最大のピーク性となる組 \((g_i, g_j, g_k)\) をその画像のしきい値として使う。値 \(g_k\) は \(g_i\) と \(g_j\) に対応するオブジェクトを分離する良いしきい値となる。</li>
</ul>
</div>
</p>
<p>
  この手法は平均グレイ値の異なる多くのオブジェクトを含む画像に一般化できる。パラメータ\((μ_1,σ_1),(μ_2,σ_2),･･･,(μ_n,σ_n)\) の標準分布グレイ値のオブジェクトが \(n\) 個あり、背景はパラメータ \((μ_0,σ_0)\) の標準分布と仮定しよう。平均が大きく異なり、分散が小さく、サイズが極端に小さいオブジェクトが無ければ、画像は \(n+1\) のピークを持つであろう。谷の位置 \(T_1, T_2, ･･･, T_n\) を決めることが出来、各区間 \([T_i, T_i+1]\) のグレイ値を持つピクセルがオブジェクトに対応するように割り当てられる(図3.4参照)。
</p>
<center><img src="images/fig3_4.png"></center>
<p>
<center>図3.4　異なる輝度値を持つ複数のオブジェクトを含んだ画像のヒストグラム</center>
</p>
<p>
<strong>反復しきい値選択 (Iterative Threshold Selection)</strong><br>
反復しきい値選択法は近似しきい値から始めて、その推定の精度を引き続き上げていく。初めのしきい値よりもうまく画像を分割する新しいしきい値を選択するために、しきい値から生じる部分画像のある特性が使えると期待されている。しきい値修正法がこの手法の成功に決定的に重要である。この方法をアルゴリズム3.2で与える。
</p>
<p>
<strong>アルゴリズム3.2  反復しきい値選択</strong>
<div class="styleBullet">
<ul>
<li>1. しきい値の初期推定を選ぶ。良い初期値は画像の平均輝度である。</li> 
<li>2. しきい値Tを使って画像をグループ \(R_1\) と \(R_2\) に分割する。</li> 
<li>3. 分割 \(R_1, R_2\) の平均グレイ値 \(μ_1,μ_2\) を計算する</li> 
<li>4. 次式に従って新しいしきい値を選択する：\(\displaystyle T=\frac{1}{2}(\mu_1+\mu_2)\)</li> 
<li>5. 次の繰り返しで \(μ_1\) と \(μ_2\) が変化しなくなるまでステップ2～4を繰り返す。</li> 
</ul>
</div>
</p>
<p>
<strong>適応しきい処理 (Adaptive Thresholding)</strong><br>
場面の照明が一様ではない場合、上の自動しきい処理手法は適さない可能性がある。不均一な照明は影による事もあるし、照明の向きによることもある。どの様な場合でも画像全体に同一のしきい値を使うことは出来ない(図3.5参照)。
</p>
<center><img src="images/fig3_5.png"></center>
<p>
図3.5　通常の閾値処理には素直に従えない一様ではない照明の画像例<br>
(a)均一な照明によるオリジナル画像、(b)オリジナルのヒストグラム<br>
(c)シミュレーションされた非一様な照明、(d)非一様な照明下の箱<br>
(e) 非一様照明下の箱のヒストグラム、(f)ヒストグラムの近似の谷T=72で閾値処理した箱<br>
通常の閾値処理では背景からオブジェクトを効果的に分割できないことに注目<br>
</p>
<p>
適応法は画像全体のヒストグラムを解析する。不均一な照明や、グレイ値の分布が不均一な背景を扱う方法は画像の小領域に目を向けるべきであり、その部分画像のみに使えるしきい値を得るために部分画像を解析する。この様な状況を扱う手法も幾つか開発されている。
</p>
<p>
  この様に画像を分割する直接的な方法は画像を \(m×m\) の部分画像に分割し、\(ij\) 番目 \((1≦i, j≦m)\) の部分画像のヒストグラムに基づいて各部分画像のしきい値 \(T_{ij}\) を選ぶ。画像の最終的な領域分割はこの部分画像の領域の和集合(union)である。この手法の結果を図3.6に示す。
</p>
<center><img src="images/fig3_6.png"></center>
<p>
<center>図3.6　通常の閾値処理に素直に従わない画像への適用閾値処理</center>
</p>
<p>
<strong>可変しきい処理 (Variable Thresholding)</strong><br>
不均一な照明の場合のもう一つの便利な方法は画像の輝度を平面や4次(双2次)方程式(biquadratic)と言った簡単な関数によって近似するものである。関数当て嵌め(fit)は背景のグレイ値により多くの部分で決められる。ヒストグラム処理、しきい処理は当て嵌め関数によって決められるベースレベルに対する相対で行われる。この手法は背景正規化法とも呼ばれる。例えば図3.7は不均一な照明での箱の画像の3次元プロットを示している。平面関数がこの関数に適しているなら、箱と背景を表している2枚のだいたいの平面の間のどこかに置く。これでこの当て嵌め平面をしきい処理の基準に使う事で箱を簡単に分離できる。平面より上にある画像内の点は箱の一部となるであろうし、平面より下は背景の一部になるであろう。
</p>
<center><img src="images/fig3_7.png"></center>
<p>
図3.7　通常の閾値処理に素直に従わない画像への可変閾値処理の適用結果<br>
(a)不均一な照明のオリジナル画像、(b)オリジナル画像の3Dプロット、(c)オリジナル画像のヒストグラム(d)オリジナルを \(T=85\) で閾値処理、(e)オリジナルを \(T=165\) で閾値処理、(f)近似平面関数 (g)オリジナルとフィット平面の差分の3Dプロット、(h)正規化画像、(i)正規化画像のヒストグラム (j) \(T=110\) での閾値処理結果
</p>
<p>
<strong>二重しきい処理 (Double Thresholding)</strong></br>
多くの応用ではあるグレイ値がオブジェクトに含まれることが判っている。しかしオブジェクトも背景も、それ以外のグレイ値を含むかもしれない。この様な場合にはオブジェクトのコア(核)を得るために控え目なしきい値 \(T_1\) を使い、その後でオブジェクト領域を成長させる何らかの方法を使うことが出来るかもしれない。領域を成長させる為に使われる方法は個々の応用に依存する。共通する方法としてはコアピクセルを近傍に持つピクセルを受け入れる別のしきい値を使ったり、ヒストグラムのような輝度特性を使ったりしてオブジェクト領域に含めるべき点をきめる等がある。単純な手法は第二しきい値 \(T_2\) より下で、元の点の集合と連結している点を全て受け入れると言うものである。この手法の概略をアルゴリズム3.3に示す。またその結果を図3.8に示す。
</p>
<p>
<strong>アルゴリズム3.3  領域成長(Region Growing)のための二重しきい処理</strong>
<div class="styleBullet">
<ul>
<li>1. 2つのしきい値 \(T_1, T_2\) を選ぶ</li>
<li>2. 画像を3つの領域に分割する：\(R_1\) は \(T_1\) 未満のグレイ値のピクセルを含む。\(R_2\) は \(T_1\) 以上、\(T_2\) 以下のグレイ値のピクセルを含む。\(R_3\) は \(T_2\) より大きいグレイ値のピクセルを含む。</li>
<li>3. 領域 \(R_2\) に割り当てられた各ピクセルを診断する。ピクセルが領域 \(R_1\) の近傍を持つならそのピクセルを領域 \(R_1\) に割り当て直す。</li>
<li>4. 割り当て直すピクセルが無くなるまでステップ3を繰り返す。</li>
<li>5. 領域 \(R_2\) に残ったピクセルを全て \(R_3\) に割り当て直す。</li>
</ul>
</div>
</p>
<center><img src="images/fig3_8.png"></center>
<p>
図3.8　単一閾値では分割が困難な画像と、その画像の二重閾値処理による分割<br>
(a)オリジナル画像、(b)オリジナル画像のヒストグラム、(c) \(T_1=70\) のコア領域、(d)第二閾値 \(T_2=155\) を使ってコア領域を成長させた結果、これを(e)(f)に示す通常の閾値処理を使った結果と比較せよ。(e)閾値\(＝T_2\)、(f) \(T_1≦閾値≦T_2\)。領域成長閾値処理を使うことなく右側の正方形全体を分割することはできない。

</p>
<p>
  アルゴリズム3.3で領域 \(R_1\) はコア領域、\(R_2\) はフリンジ(fringe：へり)領域(中間領域、過渡領域とも呼ばれる)、\(R_3\) は背景である。コア領域は、コアピクセルの近傍であるフリンジ領域からのピクセルを加えることで成長させる。領域成長の後に、コア領域に属さないピクセルは全て背景である。領域成長用の二重しきい処理アルゴリズムは値の類似性と空間的近接性の原理を実装している。フリンジピクセルとコアピクセルの2つの集合はヒストグラム上で隣接しているのでフリンジピクセルの値はコアピクセルの値に近い。また近傍でもあるのでフリンジピクセルは空間的にもコアピクセルに近い。
</p>
<h3>3.2.2  ヒストグラム法の制限</h3>
<p>
上で述べた様に領域分割用に適当なしきい値を選ぶために画像のヒストグラム内の情報を使うことが出来る。この手法はオブジェクトが一定のグレイ値を持つ応用で役に立つ。照明が場面内の場所により異なるなら画像にオブジェクトが1つしか無かったとしても単一のしきい値では画像の領域分割には不十分かもしれない。その様な場合には画像を効率良く分割し、個々の部分画像でしきい値を選択する方法を使わなければならない。我々はその外にもヒストグラムベースの領域分割用の発見的方法を見てきた。画像が複雑だとこれらの手法も不満足な動作しかしないであろう。
</p>
<p>
  ヒストグラムベースの手法の最も基本的な制限は、ヒストグラムが画像の輝度に関して空間情報を捨ててしまうと言う事実による。ヒストグラムは大域的な輝度分布を記述している。グレイ値の空間分布が著しく異なる画像のあるものが類似したヒストグラムを持つ可能性がある。例えばヒストグラムの基準だけでは、白と黒の点のランダムな分布と2値の市松模様、それに半分が白で半分が黒の画像を区別出来ない。ヒストグラムの大域的性質が複雑な場面への適用性を制限する。表面コヒーレンスのため同じオブジェクトからの点は通常空間的に近くなると言う重要な事実を利用出来ないのである。
</p>
<h2>3.3  領域表現(Region Representation)</h2>
<p>
領域は様々な文脈で使われ、多くの異なった形式で表現できる。異なる応用では異なる表現が適している。ある応用では1つの領域に対してのみ計算すれば良く、別の応用では画像内の他の領域との関係が必要になる。本節では共通して使われる若干の領域表現について述べ、それらの特徴を学習する。領域は閉じた輪郭としても表現できる事はここで言っておかなければならない。その表現は6章で改めて述べる。たいての領域表現は以下の3つのクラスの1つに分類できる。
<div class="styleBullet">
<ul>
<li>1. 配列表現</li>
<li>2. 階層表現</li>
<li>3. 記号表現</li>
</ul>
</div>
</p>
<h3>3.3.1  配列表現(Array Representation)</h3>
<p>
領域の基本表現は元の画像と同じサイズの配列を使って、ピクセルが属する領域を示すエントリー(記載)を収めると言うものである。前に戻って2章を参照すると、図2.12(b)は図2.12(a)に示される画像の領域表現になっている。つまり配列の \(ij\) 成分が値 \(α\) ならば、画像内の対応するピクセルは領域 \(α\) に属す。この表現の最も単純な例は2値画像であり、各ピクセルは領域 \(0\) の背景に属すか、領域 \(1\) の前景に属す。
</p>
<p>
  他の方法は一般にマスクとかビットマップと呼ばれる構成要素(membership)配列(画像)を使う。各領域は2値画像、その領域のマスクと関連付けられ､マスクはどのピクセルがその領域に属すかを示す。元の画像にマスクを重ねるとその領域の輝度特性を見る事が出来る。この手法の利点の1つはピクセルが1つ以上の領域の構成要素になる事を認めることにより、領域の構成要素を明確に決められない様な曖昧な状況も扱える事である。対応するピクセルは1つ以上のマスクで1になる。配列表現は領域情報を図像的(iconic)に画像形式で格納する。記号的情報はあらわには表現されない。
</p>
<p>
  ここ数年コンピュータアプリケーションではグレイ値画像の使用が増加している。この人気はラスターグラフィックス端末の採用が広がった事と、メモリの価格が下がった事による。配列表現はたいていの応用で必要とされる領域の詳細の全てを保存する。このためコンピュータでは2値マスクが非常に一般的な表現になり、それらを操作できるハードウェアが多数手に入る。
</p>
<h3>3.3.2  階層表現(Hierarchical Representation)</h3>
<p>
画像は多くの異なる解像度で表現出来る。当然、解像度を落とすと、つまり配列のサイズを減らすと何らかのデータが失われ、情報の復元は困難になる。しかし解像度の削減はメモリやコンピュータ処理要求を減らす事になる。画像の階層表現は複数の解像度での表現を可能にする。多くの応用では始めに低解像度で画像の特性を計算し、それから画像内の選択した領域に高解像度で追加の計算を行う。階層表現は画像の閲覧に使う事も出来る。階層表現で一般的な2つの形式を紹介する。ピラミッドと4進木である。
</p>
<p>
<strong>ピラミッド</strong><br>
\(n×n\) 画像のピラミッド表現は、画像とその画像のk個の縮小版からなる。一般に \(n\) は2のべき乗で、残りの画像は \(n/2×n/2, n/4×n/4,･･･,1×1\) である。画像のピラミッド表現ではレベル \(l\) のピクセルは \(l+1\) の画像のいくつかのピクセルからの情報を組み合わせる事で得られる。最上位レベルであるレベル \(0\) では画像全体が単一ピクセルで表現され、最下位レベルは元の(縮小されていない)画像である。あるレベルにおける1つのピクセルは次のレベルではいくつかのピクセルで表現される情報を集計して表現している。図3.9はある画像と、ピラミッドにおけるその縮小版を示している。ここではピラミッドは \(2×2\) 近傍のグレイ値を単純に平均することで得ている。しかし解像度縮小版を形成する別の戦略を考案することも可能である。同様にピラミッドを非直線的に細める事も可能である。
</p>
<p>
　実装の点からはピラミッド全体はサイズ \(2(2^{2×level})\) の一次元配列に収まる。
</p>
<center><img src="images/fig3_9.png"></center>
<p>
図3.9　オリジナル画像は \(512×512\)。解像度を下げたバージョンは4点を平均することで順番に得られる
</p>
<p>
<strong>4進木(quadtree)</strong><br>
4進木は2値画像用にピラミッドを拡張したものと考えることが出来る。4進木は3種類のノード(節)からなる。白、黒、そしてグレイである。4進木は画像を再帰的に分割する事で得られる。画像内の領域は図3.10に示す様に同じサイズの4つの部分領域に分割される。各部分領域に対して領域内の全ての点が白か黒ならばその領域はそれ以上分割候補とは考えない。もしも両方の種類を含むならばその領域は"グレイ領域"であると考え、更に4つの部分領域に分割する。この再帰的な分割を使って得られる画像は木構造で表現される。分割工程は木の中にグレイ領域が無くなるまで繰り返される。この構造内の各ノードはリーフノードか4つの子を持つ。このため4進木の名がある。
</p>
<p>
  4進木は空間的データベースで増えつつある応用を獲得している。ラスター配列を4進木に、4進木をラスター配列に変換するアルゴリズムが幾つか開発されている。ここ数年ポインターによりメモリ要求を減らしたコードを使って4進木を表現しようと言う努力が見られる。
</p>
<center><img src="images/fig3_10.png"></center>
<p>
図3.10　4進木の構築<br>
(a)オリジナル画像、(b)オリジナルを4つのサブ領域に分ける(木の左のノードが画像の左上の領域に対応する)。これらの領域の内、2つがグレイ領域であることに注意。(c) (b)からのグレイ領域を4つのサブ領域に分ける。それらの領域の内、1つは尚グレイ領域である。(d)最後のグレイ領域を分割し最終4進木を得る
</p>
<h3>3.3.3  記号表現 (Symbolic Representation) </h3>
<p>
領域は記号的特性を使って表現する事が出来る。一般に使われる記号的特性としては以下の様なものがある。
<div class="styleBullet">
<ul>
<li>・外接矩形</li>
<li>・重心</li>
<li>・モーメント</li>
<li>・オイラー数</li>
</ul>
</div>
</p>
<p>
記号的表現ではないが、輝度値の平均や分散といったその他の特性も画像内の領域表現として一般に使われる。これらの計量は2章で導入した計算をそのまま一般化できる。更に領域の応用に依存した特徴を表現する事も出来る。解釈するために画像を表現する場合には、近傍の領域との間の関係も表現する必要があるかもしれない。
</p>
<h4>3.3.4  領域分割のためのデータ構造(Data Structure for Segmentation)</h4>
<p>
画像の領域分割のために領域の結合と分割を実装する場合(3.4節で述べる)、形成済みの領域に関する情報を何らかのデータ構造で保持しなければならない。結合と分割操作は領域の一般的特性だけでなく、領域間の境界に関する情報も使うので、領域特性の操作を簡単にするデータ構造がいくつか提案されている。本節では領域の結合と分割を容易にするデータ構造のいくつかを述べる。
</p>
<p>
<strong>領域隣接グラフ(Region Adjacency Graph)</strong><br>
領域隣接グラフは画像内の領域とそれらの間の関係を表現するために使われる。重要性は領域と各分割の特性の形で画像を分割する事にある。図3.11に示す様に以下の規約を使う。ノードは領域を表す為に使い、ノード間のアーク(弧)は領域間で共有する境界を表す。領域の他の特性はノードのデータベースに格納されるかもしれない。RAGは領域の隣接性を強調し、領域分割で極めて重要な役割を果たす。輝度値のような原始的な特性に基づく初期分割の後で結果をRAGで表現し、より良い分割を得るために領域が組み合わせられるかもしれない。RAGを生成する方法をアルゴリズム3.4で与える。
</p>
<p>
<strong>アルゴリズム3.4  領域隣接グラフ</strong><br>
<div class="styleBullet">
<ul>
<li>1. 構成要素配列 \(a\) を走査し、各ピクセルインデックス \([i, j]\) で以下のステップを実行する</li>
<li>2. \(r_1＝a[i, j]\)とする。</li>
<li>3. \([i, j]\) のピクセルの近傍 \([k, l]\) を診断する。各近傍に対して以下のステップを実行する。</li>
<li>4. \(r_2=a[k, l]\) とする。\(r_1≠r_2\) なら領域隣接グラフ内のノード \(r_1\) と \(r_2\) の間にアークを追加する。</li>
</ul>
</div>
</p>
<p>
  領域隣接グラフの双対もある状況では使われる可能性がある。双対表現ではノードが境界を表し、アークが境界によって分けられる領域を表す。
</p>
<center><img src="images/fig3_11.png"></center>
<p>
図3.11　領域分割された画像用の領域隣接グラフ<br>
上段：領域分割された画像、中段：領域隣接グラフ、下段：領域隣接グラフの双対
</p>
<p>
<strong>ピクチャ・ツリー (Picture Trees)</strong><br>
ピクチャ・ツリーは他の領域の中の領域の包含を強調する。図3.12に示すこの表現は通常再帰的である。この表現の変形である本節で前に述べた4進木は大きな注目を集めた。4進木では領域の位置によらず矩形領域は同じサイズの4つの領域に分割されたが、ピクチャ・ツリーでは重要性は領域の入れ子にある。ピクチャ・ツリーは通常、画像を再帰的に要素部分に分割することで作られ、分割は領域が一様な特性を持つようになると止まる。この表現は後の節の形状表現で詳しく述べる。
</p>
<center><img src="images/fig3_12.png"></center>
<p>
<center>図3.12　領域内の包含関係を表現するピクチャ・ツリーの構築例</center>
</p>
<p>
<strong>超格子 (Super Grid)</strong><br>
ある種の応用では画像配列に領域分割の情報を収める事が望まれる。この様な状況では境界表現はある種の問題を生じる。直観的には境界は隣接する2つの領域のピクセルの間に位置すべきである。しかし画像表現では境界はピクセルであることが多い。このジレンマは画像格子に超格子を導入することで解決できる(図3.13参照)。元の画像が \(N×N\) ならば超格子は \((2N+1)×(2N+1)\) になる。各ピクセルは超格子上の8個の非ピクセル点で囲まれる。非ピクセル点は2つのピクセルの間に境界があるか無いか、[あるなら]境界はどの方向に走っているかを示すために使われる。この表現は画像の任意の2ピクセル間の境界を明示的に表現することで、結合・分割操作を容易にする。
</p>
<center><img src="images/fig3_13.png"></center>
<p>
図3.13　超格子領域表現<br>
左：ピクチャ格子、中央：従来の境界表現、右：超格子表現。通常の表現とは異なり、境界は2つの領域の間にあることに注意
</p>
<h2>3.4  分割(Split)と結合(Merge)</h2>
<p>
単純な輝度ベースの領域分割は一般には多くの領域を生じすぎる。たいていの人間の目には一定のグレイ値で非常に鮮明な領域に見える画像でさえ、しきい処理アルゴリズムの出力は多くの余分な領域を含んでいる可能性がある。この問題の主な原因は高周波ノイズと、異なる領域のグレイ値間の段階的遷移にある。
  初期の輝度ベースの領域分割の後で、領域分割は精度を上げたり再編したりする必要があるかもしれない。その様な、単純な領域分割手法で得られた領域の後処理用の手法が幾つか提案されている。それらの手法のあるものは領域依存の知識を使い、別の手法は画像処理の知識を使う。精緻化(refinement)は人が対話的に行うかも知れないし、コンピュータで自動的に行うかも知れない。自動システムではオブジェクトの特性や画像に関する一般知識に基づいて領域分割を改善しなければならないであろう。
</p>
<p>
  自動精緻化は分割操作と結合操作の組み合わせを使って行われる。分割と結合は、同じオブジェクトに属する隣接領域を結合することで誤りの境界や偽りの領域を取り除き、異なるオブジェクトの一部を含む領域を分割することで失われていた境界を付け足す。精緻化用に可能な手法には以下の様なものがある。
<div class="styleBullet">
<ul>
<li>・類似した特性の隣接領域を結合する</li>
<li>・疑問のあるエッジを取り除く</li>
<li>・領域のトポロジー的特性を使う</li>
<li>・場面内のオブジェクトに関する形状情報を使う</li>
<li>・場面に関する意味論的情報を使う</li>
</ul>
</div>
</p>
<p>
最初の3つの手法は領域とは独立した特性と組み合わせた画像輝度に関する情報のみを使う。これらの手法を次に述べる。
</p>
<h3>3.4.1  領域結合(Region Merging)</h3>
<p>
結合操作は類似していると考えられる領域を組み合わせる。高レベルの結合アルゴリズムをアルゴリズム3.5で与える。このアルゴリズムは以下の節で述べる任意の領域類似性計量に合わせて改造する事が出来る。
</p>
<p>
<strong>アルゴリズム3.5  領域結合</strong><br>
<div class="styleBullet">
<ul>
<li>1. しきい処理(または同様の手法)とその後の成分ラベル付けを使って画像の初期領域を形成する。
<li>2. 画像に対する領域隣接グラフを用意する。 </li>
<li>3. 画像内の各領域に対して以下のステップを実行する。 </li>
<ul>
    <li>(a) 隣接ずる領域を検討し、類似しているかテストする。 </li>
    <li>(b) 類似している領域を結合しRAGを更新する。 </li>
</ul>
<li>4. 結合される境域が無くなるまでステップ3を繰り返す。 </li>
</ul>
</div>
</p>
<p>
  しかしこの様な単純なアルゴリズムを適用する場合、尚問題が生じるかも知れない。以下の例を考えよう。隣接する3つの領域 \(A, B, C\) を含む画像があるとする。類似性属性は \(A\) と \(B\) が類似しており、\(B\) と \(C\) も類似していると別々に判定する。しかし \(A\) と \(C\) は類似していない。類似領域を結合する場合、たとえ \(A\) と \(C\) が類似していなくても、\(A\) と \(B\) を結合し \(B\) と \(C\) を結合すると言う個々の局所的な判定により、3つの領域は1つに合体されるであろう。この場合には、類似領域を結合する前に別の領域特性を考慮しなければならない。
</p>
<p>
  結合アルゴリズムにおける最も重要な操作は、2つの領域間の類似性を決める事である。領域の類似性を判定する多くの手法が提案されている。大雑把に言って類似性を判定する手法は、領域のグレイ値に基づくかあるいは領域間の境界の弱さに基づいており、領域の空間的近接性も含まれるかも知れない。
</p>
<p>
<br>領域ベースの結合処理</strong><br>
隣接領域の類似性を判定する2津の手法として以下がある。
<div class="styleBullet">
<ul>
<li>1. 平均輝度を比較する。平均輝度が予め決められた値ほど違っていないならば領域は類似していると考えられ、結合の候補になるべきである。この手法の変形は、領域を1枚の平面で近似できるか否かを判断する表面当て嵌め(surface fitting)を使う。</li><br>
<li>2. 輝度値は確率分布から引き出せると仮定する。同じ輝度値の統計分布を持つ確率に基づいて、隣接する領域を結合するか否かを検討する。この手法は隣接領域の類似性判定を検定する仮設を用い、それについて以下で更に詳しく述べる。</li>
</ul>
</div>
</p>
<p>
<strong>統計的に類似な領域の結合処理</strong><br>
この手法は結合すべきか否かを決めるために隣接する2つの領域の統計的特性を検討する。画像内の領域は一定のグレイ値を持つが、平均0のガウシアンノイズで、統計的機に独立に加法的に汚され、そのためグレイ値は正規分布から引き出されると仮定しよう。2つの隣接領域 \(R_1, R_2\) はそれぞれ \(m_1, m_2\) 個の点を含むとする。2つの仮設がある。
<div class="styleBullet">
<ul>
<li>\(H_0\)：両方の領域は同じオブジェクトに属す。この場合、輝度は全てパラメータ\((μ_0,σ_0)\)の1つのガウス分布から引き出せる。</li><br>
<li>\(H_1\)：領域は異なるオブジェクトに属す。この場合、各領域の輝度はパラメータ\((μ_1,σ_1),(μ_2,σ_2)\) の別々のガウス分布から引き出せる</li>
</ul>
</div>
</p>
<p>
一般にこれらのパラメータは分かっていないが、サンプルを使って推定される。例えば領域が次式で与えられる正規分布から引き出されるグレイレベル \(g_i,\;i＝1, 2, ･･･, n\) の \(n\) 個のピクセルを含む場合、
\[
p(g_1)=\frac{1}{\sqrt{2\pi}\sigma}e^{-\frac{(g_i-\mu)^2}{2\sigma^2}} \tag{3.1}
\]
</p>
<p>
パラメータに対する最尤推定(Maximum Likelihood Estimation)方程式は次式で与えられる。
\[
\begin{align}
\hat{\mu} &= \frac{1}{n}\sum_{i-1}^n g_i \tag{3.2} \\
\hat{\sigma}^2 &= \frac{1}{n}\sum_{i=1}^n (g_i-\hat{\mu})^2 \tag{3.3}
\end{align}
\]
仮設 \(H_0\) では単一分布 \(N(μ_0,σ_0^2)\) から全てのピクセルが独立して引き出される。\(H_0\) での結合確率密度は次式で与えられる。
\[
\begin{align}
p(g_1,g_2,\cdots,g_{m_1+m_2}\mid H_0) &=\prod_{i=1}^{m_1+m_2} p(g_i\mid H_0) \tag{3.4}\\
\\
&=\prod_{i=1}^{m_1+m_2}\frac{1}{\sqrt{2\pi}\sigma_0}e^{^\frac{(g_i-\mu_0)^2}{2\sigma_0^2}} \tag{3.5}\\
\\
&=\frac{1}{(\sqrt{2\pi}\sigma_0)^{m_1+m_2}}e^{-\frac{\sum\limits_{i=1}^{m_1+m_2}(g_i-\mu_0)^2}{2\sigma_0^2}} \tag{3.6}\\
\\
&=\frac{1}{(\sqrt{2\pi}\sigma_0)^{m_1+m_2}}e^{-\frac{(m_1+m_2)}{2}} \tag{3.7}
\end{align}
\]
仮設 \(H_1\) では \(m_1\) 個のピクセルが \(N(μ_1,σ_1^2)\) 分布の領域 \(1\) に属し、\(m_2\) 個のピクセルが \(N(μ_2,σ_2^2)\) 分布の領域 \(2\) に属す。この仮設では連結の密度関数は以下で与えられる。
\[
\begin{align}
p(g_1,g_2,\cdots,g_{m_1},g_{m_1+1},\cdots.g_{m_1+m_2}\mid H_1)\\
\\
=\frac{1}{(\sqrt{2\pi}\sigma_1)^{m_1}}e^{-\frac{m_1}{2}}\frac{1}{(\sqrt{2\pi}\sigma_2)^{m_2}}e^{-\frac{m_2}{2}} \tag{3.8}
\end{align}
\]
尤度比(likelihood ratio) \(L\) は2つの仮設における確率密度の比として定義される。
\[
\begin{align}
K &=\frac{p(g_1,g_2,\cdots\mid H_1)}{p(g_1,g_2,\cdots\mid H_0)} \tag{3.9}\\
\\
&=\frac{\sigma_0^{m_1+m_2}}{\sigma_1^{m_1}\cdot\sigma_2^{m_2}} \tag{3.10}
\end{align}
\]
上の方程式のパラメータ \(σ_0,σ_1,σ_2\) の値は数式3.2、3.3にそれぞれ \(m_1+m_2\) ピクセル全て、領域 \(1\) からの \(m_1\) ピクセル、領域 \(2\) からの \(m_2\) ピクセルを使って推定する。尤度比 \(L\) がしきい値よりも低いなら、領域は1つしかなく2つの領域は結合すべきであると言う見込みに対する強い証拠となる。
</p>
<p>
  この手法はエッジの検出に使ってもよい。尤度比はどの場合に領域が分離していると考えるべきであるかを示しているので、どの場合に2つの領域に境界があるべきであるかも示している。エッジ検出用としては、点の両側の近傍間の尤度比がエッジの存在の検出に使う事が出来る。
</p>
<p>
  この比率には多くの応用で重要な役割を果たす事が出来る別の変形版もある。尤度比は、領域は一定のグレイ値を含んでいるがノイズのため正規分布を持っていると言う仮定の元で導かれた。基礎となる輝度分布が一定ではなく、平面や4次方程式で表されると仮定する事も可能である。この様な仮定で尤度比を導いて同じように使う事も可能である。
</p>
<h3>3.4.2  弱いエッジの除去(Removing Weak Edges)</h3>
<p>
結合のためのもう一つの手法は、領域間の境界が弱い場合2つの領域を組み合わせると言うものである。この手法は輝度特性だけでなく共通境界の長さも考慮する事により、隣接領域の間の弱いエッジを取り除こうと試みる。境界が弱く、(領域を結合した)結果の境界でグレイ値が急激に変化しないならば、共通境界を取り消す。以下の議論で使う表記を図3.14、3.15に示す。
</p>
<center><img src="images/fig3_14.png"></center>
<p>
図3.14　アプローチ1：弱い境界と最小領域周囲長の比がある閾値を超えた場合、弱い境界を除去することで結合する。左：弱い境界は小さい領域の周囲長に対して非常に短いので2つの領域は結合すべきではない。右：共通境界の弱い部分は小さい領域の周囲長のかなりの割合なので、2つの領域は1つの領域に結合すべきである。強い境界は太線で記されているのに対して、弱い境界は2つの領域の色の違いで示されていることに注意
</p>
<center><img src="images/fig3_15.png"></center>
<p>
図3.15：アプローチ2：弱い境界と共通境界全体の比がある閾値を超えた場合、弱い領域を除去することで結合する。左：弱い領域は共通境界全体に対して小さいので2つの領域は結合すべきではない。右：境界の弱い部分はほぼ共通境界全体と同じので、2つの領域は1つの領域に結合すべきである。強い境界は太線で示されているのに対して、弱い領域は2つの領域の色の違いで示されていることに注意。
</p>
<p>
  弱い境界とは両側の輝度がある量Tよりも違わない境界の事である。エッジ性(？edgeness)と言ったその他の基準が2つの領域を分けている境界上のエッジの点の強さをきめるのに使う事が出来るかもしれない。領域間の弱い境界を消す事で領域を結合するアルゴリズムでは、領域間の弱い境界と完全な境界の相対長を検討しなければならない。相対長を検討する手法としては次の2つがある。
<div class="styleBullet">
<ul>
<li>1. 次式が成り立つならば隣接領域 \(R_1\) と \(R_2\) を結合する。
\[
\frac{W}{S}\gt \tau
\]
ここで \(W\) は境界の弱い部分の長さであり \(τ\) はしきい値、\(S＝min(S_1, S_2)\) は図3.14に示す様に2つの領域の周囲長の最小値である。このアルゴリズムでは性能は \(τ\) に依存する。\(τ\) の値が小さいと結合する領域が多くなりすぎる。\(τ\) の値が大きいとアルゴリズムは保守的になりすぎる。発見的な \(τ\) の適性値 \(0.5\) である。</li><br>
<li>2. 次式が成り立つならば \(R_1\) と \(R_2\) を結合する。
\[
\frac{W}{S}\gt \tau
\]
ここで、\(S\) は図3.15に示す様に共通境界である。パラメータ値 \(τ＝0.75\) で通常は満足のいく結果が得られる。</li>
</ul>
</div>
</p>
<h3>3.4.3  領域分割 (Region Splitting)</h3>
<p>
領域のある特性が一定でないなら領域は分割すべきである。分裂手法に基づいた領域分割は大きな領域から始める。多くの場合、開始領域として画像全体から始める。分割アルゴリズムをアルゴリズム3.6で与える。
</p>
<p>
<strong>アルゴリズム3.6  領域分割</strong><br>
<div class="styleBullet">
<ul>
<li>1. 画像内に初期領域を形成する。</li>
<li>2. 画像内の各領域に対して以下のステップを再帰的に実行する。</li>
    <ul>
    <li>(a) 領域のグレイ値の分散を計算する。</li>
    <li>(b) 分散がしきい値より大きいならば適当な境界に沿って領域を分割する。</li>
    </ul>
</ul>
</div>
</p>
<p>
  領域を分割する前に幾つか決めておかなければならない事がある。問題は通常どの場合に特性が領域に渡って一定していないと判断するかと言う事と、分割後の各成分で特性が一定になるようにするためにはどの様に分割したら良いかと言う事である。これらの疑問は通常応用に依存しており、その応用における領域に関する知識を必要とする。ある応用ではグレイ値がどの程度一定に近いかの計量として輝度値の分散が使われる。別の応用では輝度値を近似するために関数の当て嵌めが行われる。そしてその関数と実際の輝度値の誤差が領域の類似性の計量に使われる。
</p>
<p>
  グレイ値が領域に渡って一定しているかを判断する事よりも難しいのが領域をどこで分割するかの判断である。領域の分割で最良の境界を決めるために使われる一つの手法は、領域内のエッジ強度の計量を検討すると言うものである。領域分割の最も初期の手法は一定数の等しいサイズの領域に分割する手法である。これは規則的分解法(regular decomposition method)と呼ばれる。3.3.2節で述べた画像の4進木手法は規則的分解法の一例である。
</p>
<p>
  しかし4進木手法は非2値(グレイ値)画像の領域分割に使うためには修正しなければならない。白、黒の領域を考える代わりに画像輝度の分散を使って領域を分割すべきか否かを決める。領域を分割する方法は多数あるため、一般に領域を分割する事は結合するよりも難しい。
</p>
<h4>3.4.4  分割(Split)と結合(Merge)</h4>
<p>
分割と結合の操作は一緒に使われる事もある。しきい処理に基づく予備分割の後で一連の分割と結合を適用して領域分割の精度を上げるかも知れない。分割と結合を組み合わせたアルゴリズムは複雑な場面を領域分割するのに役立つ。分割と結合操作を導くために領域の知識が持ち込まれる場合もある。
</p>
<p>
  画像が領域の集合 \(\{R_k\}、k＝1, 2, ･･･, m\) に分割されると仮定しよう。領域に適用される属性 \(P\) で規定されるある特性に従うと領域内の全てのピクセルは同質になる。属性は領域内のピクセル間の類似性を表現している。例えば属性は領域内のグレイ値の分散を使って定義できる。
\[
P(R)=
\begin{cases}
1 & 分散が小さい場合 \\
0 & それ以外の場合
\end{cases}
\tag{3.11}
\]
領域分割用の分割と結合アルゴリズムをアルゴリズム3.7で概説している。
</p>
<p>
<strong>アルゴリズム3.7  分割と結合</strong>
<div class="styleBullet">
<ul>
<li>1. 単一領域として画像全体から始める。</li>
<li>2. 領域 \(R\) を取り上げる。\(P(R)\) が偽なら領域を4つの部分領域に分割する。</li>
<li>3. 画像内の任意の2つかそれ以上の隣接部分領域 \(R_1, R_2, ･･･, R_n\) を検討する。\(P(R_1∪R_2∪･･･∪R_n)\) が真ならn個の領域を1つの領域に結合する。</li>
<li>4. 分割や結合が起こらなくなるまで上のステップを繰り返す。</li>
</ul>
</div>
</p>
<h2>3.5  領域成長 (Region Growing)</h2>
<p>
多くの画像で個々の領域のグレイ値は一定どころではなく、領域分割にはもっと洗練された手法を使わなければならない。最良の方法は、画像は単純な関数でモデル化された領域に分割できると言う仮定に基づいている。この考えは自然に領域分割に適用される。
</p>
<p>
  3.2節で述べた領域分割問題はシード(種)となる領域から始めて、制約を満たすより大きな領域へと成長させるアルゴリズムに至る。本テキストの例では均質性条件は平面や4次関数(biquadatic function)に領域内のグレイ値を当て嵌める事に基づく。しかし一般には均質性条件は平均輝度や分散、テクスチャ、色と言った画像内の領域の任意の特性に基づく。アルゴリズムをアルゴリズム3.8で与える。
</p>
<p>
<strong>アルゴリズム3.8  平面と4次関数モデルを使った領域成長</strong>
<div class="styleBullet">
<ul>
<li>1. 画像を初期シード領域 \(R_i^{(0)}\) に分割する。</li><br>
<li>2. 各シード領域に対して平面モデルを当て嵌める。\(χ^2\) 誤差が十分小さいならシード領域とその
     モデルを受け入れる。そうでなければシード領域を拒絶する。</li><br>
<li>3. 各領域に対して、領域モデルを領域の近傍に外挿する事により領域に適合する全ての点を求める。
     適合点は以下のように定義する。
     \(C_i^{(k)}＝\{(x, y)\mid d^2 (x, y, a, m)≦ε\) かつ \((x, y)\) は \(R_i^{(k)}∪C_i^{(k)}\) の4近傍 \(\}\)
     ここで \(ε\) は適合性しきい値である。</li><br>
<li>4. 適合点が無い場合はモデルの次数を増やす：\(m←m+1\)。モデルの次数が最大次数を超える場合は
     それ以上領域成長は行わない。そうでなければステップ3に戻って領域成長を続ける。</li><br>
<li>5. 新しい領域 \(R_i^{(k＋1)}＝R_i^{(k)}∪C_i^{(k)}\) を形成し、同じ次数でモデルを新しい領域に再当て嵌めを行っ
     て、当て嵌まり具合(?goodness of fit) \(χ^2(R_i^{(k＋1)}, a, m)\) を計算する。</li><br>
<li>6. 新旧の領域モデルの当て嵌まり具合の差を計算する：
\[
     ρ^{(k＋1)}＝χ^2 (m, a^{(k＋1)}, R_i^{(k＋1)})－χ^2 (m, a^{(k)}, R_i^{(k)})
\]
</li><br>
<li>7. \(ρ^{(k＋1)}＜T_1\) ならばステップ3に戻って領域成長を続ける。</li><br>
<li>8. モデルの次数を増やす：\(m←m+1\)。モデルの次数が最大次数を超える場合はそれ以上領域成長
     は行わない。</li><br>
<li>9. 新しいモデル次数mで領域モデルの再当て嵌めを行う。当て嵌め誤差が減るならば新しいモデル
     次数を受け入れ、ステップ3に戻って領域成長を続ける。そうでなければ領域 \(R_i\) をそれ以上
     成長させない。</li>
</ul>
</div>
</p>
<p>
  アルゴリズムは画像を \(n×n\) の領域(\(n\) は通常5～9)に分割する事から始める。単一の平面や4次関数が2つの領域で当てはまるならばそれらの領域は結合される。平面と4次関数モデルは基底関数の線形結合である。基底関数は可変次数の2変数多項式(bivariate polynomials)を張るのでモデルは
\[
f(x,y,a,m)=\sum_{i+j\leq m}a_{ij}x^iy^j \tag{3.12}
\]
ここでモデルの次数 \(m\) は \(0≦m≦2\) に制限されている。これは領域モデルが平面か4次関数に制限されている事を意味する。
</p>
<p>
均質性条件は領域をモデル化している関数から領域内の点までの距離に基づいている。
\[
\chi^2(R,a,m)=\sum\limits_{(x,y)\in R} d^2(x,y,a,m) \tag{3.13}
\]
ここで距離は通常のユークリッド距離である。
\[
d^2(x,y,a,m)=\{g(x,y)-f(x,y,a,m)\}^2 \tag{3.14}
\]
画像平面上の点 \((x, y)\) のグレイ値 \(g(x, y)\) とは、その画像位置のピクセルのグレイ値の事である。点の集合 \(R\) を与えると問題は誤差関数 \(χ^2 (R, a, m)\) を最小にするモデルの次数 \(m\) とモデルパラメータを求める事になる。これは最小二乗問題であり、特異値分解(singular value decomposition)を使って解く事が出来る。単一値分解の完全な議論は文献[196]と付録Aを参照して欲しい。
</p>
<p>
  点の集合の組み合わせに対して面を再当て嵌めする前に表面パッチに対して点の適合性チェックを行う理由は、最小二乗当て嵌めは外来ノイズに非常に敏感だからである。もしも外来ノイズが当て嵌めの前に領域に加わると表面パッチは外来ノイズによってひどく歪み、実際には領域に属している点でももはや当て嵌まらなくなってしまう。
</p>
<p>
  画像が個々の面でモデル化される領域にどの様に分割されるべきかを前もって知る事は出来ない。
なぜならそれこそが領域分割問題だからである。精密な手法を使って控えめなシード領域を探す事も出来る。シードを探すために控えめなしきい値を使う事が可能である。領域の知識や画像の性質を使って洗練された手法でシードを探す事も出来る。例えば初期シードを探すためにレンジ画像微分幾何学特性が使われるかもしれない。これを行うためのコンピュータ処理的に効率的な手法はシード領域を識別するために一般的な画像特性の幾つかを使う。画像を7×7のシード領域に分割し、それらのシード領域に表面の当て嵌めを行う事も出来る。シード領域は表面パッチへの当て嵌めのχ二乗誤差に基づいて受け入れられる。7×7パッチがはじかれた場合はもっと高い解像度にするために5×5表面パッチで置き換える。適合する点を取り込む事で領域は太っていく。領域に対する表面パッチが表面からそれほどは離れていない値を持つ点を含めるように拡張できるならば、その点は適合である。元の点に適合点を加えた新しい領域に渡って表面パッチが再当て嵌めされる。
</p>
<p>
  1つ以上の領域と関連付けられた点を見とめる事も出来る。曖昧さはモデル選択を行う後工程で解決される。古典的な領域成長では各点は多くても1つの領域としか関連付けられなかった。この制約は両方の領域で表面パッチモデルの当て嵌めが改善する場合に限り、ある領域から別の領域へ点を移動する様にアルゴリズムを修正する事で実施する事が出来る。もっと正確に言うと両方の領域に対する表面当て嵌めの結合誤差が低くなる場合に限り点を再割り付けする。図3.16にこの手法の結果を示す。
</p>
<p>
  前に述べた古典的領域分割技法は表面パッチが一定に制約された領域成長技法であると見なす事が出来る。言い換えると領域とは画像輝度がほぼ一定で、画像は画像輝度が一定の断片的な領域に分割できると仮定している。より洗練した領域分割技法ではこの仮定を一般化して陰影による現実的な輝度変動を認めている。
</p>
<center><img src="images/fig3_16.png"></center>
<p>
図3.16　ここで与えた領域成長アルゴリズムを使った画像の領域分割。パート(a)は輝度画像に対する結果を示し、(b)はレンジ画像(距離画像)に対する結果を示す
</p>
    </body>
</html>