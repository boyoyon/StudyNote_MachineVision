<!doctype html>
<html lang="ja">
    <head>
        <script type="text/javascript" id="MathJax-script" async
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
        <meta charset="utf-8" />
        <title>テクスチャー</title>
        <style type="text/css">
            p
            {
                padding-left: 2em;
            }
            .margin-large
            {
                margin-left: 30px;
            }
           .margin-abstract {
               margin-left: 60px; /* 左マージンを広くする */
               margin-right: 60px; /* 右マージンを広くする */
           }
        </style>
    <style>
        .two-columns {
            display: flex;
            flex-direction: row;
            gap: 20px; /* 列間のスペース */
        }
        .column {
            flex: 1; /* 各列が均等に幅を取る */
        }
    </style>
<style>
.three-columns {
  display: flex;
  gap: 10px; /* 列間の余白を設定 */
}
.column {
  flex: 1; /* 各列の幅を均等にする */
  padding: 10px; /* 内側の余白を設定 */
}
</style>
    <style>
        .styleRef { 
            text-indent: -40px; /* 最初の行の字下げを逆方向に */
            margin-left: 10px; /* 2行目以降の字下げを調整 */
            ul {
                  list-style-type: none; /* 箇条書き記号を非表示 */
                  padding-left: 40px; /* 全体の左余白 */
            }
            li {
            }
        }
    </style>
    <style>
        .styleBullet { 
            text-indent: -30px; /* 最初の行の字下げを逆方向に */
            margin-left: 30px; /* 2行目以降の字下げを調整 */
            ul {
                  list-style-type: none; /* 箇条書き記号を非表示 */
                  padding-left: 50px; /* 全体の左余白 */
            }
            li {
            }
        }
    </style>
    <style>
            ol
            {
                margin-left: 30px;
            }
            ul
            {
                margin-left: 30px;
            }
    </style>
    </head>
    <body>
        <h1><center>７章 テクスチャー</center></h1>
<h2>7.1 はじめに</h2>
<p>
テクスチャーは、表面検査、シーン分類、表面の向きや形状の判定など、多くのマシンビジョンタスクにおいて重要な役割を果たす。例えば、表面テクスチャーの特徴は半導体ウェーハの検査に、均質なテクスチャー領域のグレーレベル分布の特徴は航空写真の分類に、透視投影によるテクスチャーパターンの変化は物体の3次元形状の判定に使用される。
</p><p>
　テクスチャーは、近傍におけるグレーレベルの空間分布によって特徴付けられる。したがって、テクスチャーを点に対して定義することはできない。画像を観察する解像度によって、テクスチャーが認識されるスケールが決まる。例えば、タイル張りの床の画像を遠くから観察する場合、タイルの配置によって形成されるテクスチャーは観察されるが、タイル内のパターンは認識されない。同じシーンをより近い距離から観察し、視野内にタイルが数枚しか入らないようにすると、各タイルを構成する詳細なパターンの配置によって形成されるテクスチャーが認識され始める。ここでは、テクスチャーを、観察解像度では個別の物体として区別できないほど微細な、画像強度の局所的な変化の繰り返しパターンと定義できる。したがって、画像領域内で繰り返し出現する、特定のグレーレベル特性を満たす連結されたピクセルの集合は、テクスチャー領域を構成する。簡単な例としては、白い背景に繰り返されるドットパターンが挙げられる。このページのような白い紙に印刷されたテキストもテクスチャーを構成する。ここで、各グレーレベルプリミティブは、各文字を表すピクセルの連結集合によって形成される。文字を線上に配置し、線をページの要素として順番に配置するプロセスにより、順序付けられたテクスチャーが生成される。テクスチャー解析には、テクスチャーの分類、テクスチャーのセグメンテーション、そしてテクスチャーからの形状復元という3つの主要な課題がある。
</p><p>
　テクスチャー分類における問題は、与えられたテクスチャークラスの集合から、与えられたテクスチャー領域を識別することである。例えば、航空写真上の特定の領域は、農地、森林地帯、あるいは市街地などに属する可能性がある。これらの領域はそれぞれ独自のテクスチャー特性を持っている。テクスチャー解析アルゴリズムは、各領域から特徴的な特徴を抽出し、これらのパターンの分類を容易にする。これには、領域間の境界が既に決定されているという仮定が暗黙的に含まれている。テクスチャー分類では、統計的手法が広く用いられている。画像のグレーレベルから、グレーレベルの共起性、コントラスト、エントロピー、均質性といった特性を計算し、分類を容易にする。これらについては、7.2節で説明する。統計的手法は、テクスチャープリミティブが小さく、マイクロテクスチャーとなる場合に特に有効である。一方、テクスチャープリミティブのサイズが大きい場合は、まず基本プリミティブの形状と特性を決定し、次にこれらのプリミティブの配置規則を決定して、マクロテクスチャーを形成する必要がある。このような構造的手法については、7.3節で簡単に説明する。分類のためのテクスチャー特性を決定するための画像ピクセルのボトムアップ分析の代替として、モデルベースでテクスチャーを合成する手法が研究されている。これらの手法では、まずテクスチャーのモデルを仮定し、そのモデルを用いて合成された画像が入力画像領域に非常に類似するように、画像領域からそのパラメータを推定する。推定されたパラメータは、領域を分類するための識別特徴として有用である。これらについては7.4節で説明する。
</p><p>
　単一の均質領域のクラス ラベルをその領域から計算されたプロパティを使用して決定するテクスチャー分類とは対照的に、テクスチャー セグメンテーションは、画像内のさまざまなテクスチャー領域間の境界を自動的に決定することに関係している。定量的なテクスチャー測定値は、一度決定されればセグメンテーションに役立つが、テクスチャー特徴を決定するための統計的手法のほとんどは、計算が単一のテクスチャー領域に限定されない限り、正確な測定値を提供しない。領域ベースの方法と境界ベースの方法の両方が、テクスチャー画像のセグメンテーションに試みられてきた。これらの方法は、前の章で説明したオブジェクトと背景の分離方法に使用される方法に類似している。テクスチャー セグメンテーションは依然として研究が活発に行われている分野であり、それぞれ特定のアプリケーション向けに設計された多数の方法が文献で提案されている。しかし、さまざまな状況で役立つ一般的な方法はない。したがって、本書ではテクスチャー セグメンテーション方法については取り上げない。
</p><p>
　テクスチャープリミティブの密度、サイズ、方向といったテクスチャー特性における画像平面上の変化は、テクスチャーから形状を生成するアルゴリズムで活用される手がかりである。例えば、テクスチャー要素のプリミティブサイズの最大変化の大きさと方向として定義されるテクスチャー勾配は、表面の方向を決定する。テクスチャー要素の形状の変化（例えば、円が楕円として現れるなど）を定量化することも、表面の方向を決定するのに役立つ。これらについては、7.5節で説明する。
</p>
<h2>7.2 テクスチャー分析の統計的手法</h2>
<p>
テクスチャーは空間的な特性であるため、単純な1次元ヒストグラムはテクスチャーの特性評価には役立たない（例えば、ピクセルが市松模様のように黒と白に交互に並ぶ画像と、上半分が黒で下半分が白の画像のヒストグラムは同じになる）。テクスチャーの知覚に寄与するグレーレベル値の空間依存性を捉えるために、グレーレベル共起行列と呼ばれる2次元従属行列がテクスチャー解析で広く用いられている。広く用いられているもう一つの指標は自己相関関数である。このセクションでは、これらについて簡単に説明する。
</p><p>
<strong>グレーレベル共起行列</strong><br>
グレーレベル共起行列 \(P[i,j]\) は、まず変位ベクトル \(\mathbf d = (dz, dy)\) を指定し、グレーレベル \(i\) と \(j\) を持つ \(\mathbf d\) で区切られたすべてのピクセルペアを数えることで定義される。例えば、図 7.1(a) に示すような、グレーレベル \(0, 1,2\) を持つ単純な \(5×5\) 画像を考える。グレーレベルは 3 つしかないため、\(P[i,j]\) は \(3×3\) 行列になる。位置演算子を \((1,1)\) と指定すると、これは 1 ピクセル右と 1 ピクセル下という解釈になる。\(5×5\) 画像には、この空間的な分離を満たすピクセルペアが 16 組ある。ここで、最初のピクセルの値が \(i\) で、最初のピクセルから \(\mathbf d\) だけ離れた対応するピクセルのペアの値が \(j\) であるすべてのピクセルペアを数え、この数を行列 \(P[i, j]\) の \(i\) 行 \(j\) 列目に入力する。例えば、指定された距離だけ離れた \([2, 1]\) の値を持つピクセルペアが3つあるため、エントリ\(P[2, 1]\) の値は \(3\) になる。完全な行列 \(P[i,j]\) は図7.1(b)に示されている。

</p>
<center><img src="images/fig7_1.png"></center>
<p>
<center>図7.1　(a) 3つのグレーレベル \(0, 1, 2\) を持つ \(5×5\) 画像。(b) \(\mathbf d = (1,1)\) のグレーレベル共起行列。</center>
</p><p>
<br>
(ここから蛇足)<br>
　上の説明だけでは分かりにくいので、グレーレベル共起行列の構築過程をアニメーションにしてみた(正規化は省略している)。
</p>
<center><img src="images/fig7_0.gif"></center>
<p>
(ここまで蛇足)
</p><p>
\(P[i,j]\) は対称ではないことに注意。これは、グレーレベル \([i, j]\) を持つピクセルペアの数が、グレーレベル \([j,i]\) を持つピクセルペアの数と必ずしも一致しないためである。\(P[i, j]\) の要素は、各要素をピクセルペアの総数で割ることで正規化される。この例では、各要素を16で割っている。この正規化された \(P[i,j]\) は、要素の合計が \(1\) になるため、確率質量関数として扱われる。
</p><p>
次の簡単な例を使えば、グレーレベル共起行列がグレーレベルの空間分布を捉えていることを簡単に説明できる。図 7.2(a) に示すような、各正方形が 1 つのピクセルに対応する、チェッカーボードの\(8×8\) バイナリ画像を考えてみよう。グレー レベルは 2 つしかないので、\(P[i, j]\) は \(2×2\) 行列になる。前と同じように \(\mathbf d = (1,1)\) と定義すると、図 7.2(b) に示すような正規化された \(P[i,j]\)  が得られる。ピクセルの構造が明確に定義されているため、発生するペアは \([1,1]\) と \([0,0]\) のみであり、非対角要素は 0 であることに注意。同様に、ベクトル \(\mathbf d\) を \((1,0)\) と定義すると、図 7.2(c) に示すように、\([0,1]\) と \([1,0]\) に対応するエントリのみになり、対角要素は\(0\) になる。
</p>
<center><img src="images/fig7_2.png"></center>
</p>
<p>
図7.2　(a) \(8×8\) のチェッカーボード画像。(b) \(\mathbf d = (1,1)\) のグレーレベル共起行列。(c) \(\mathbf d = (1, 0)\) のグレーレベル共起行列。
</p>
<p>
上記の例において、黒ピクセルが画像全体にランダムに分布し、固定された構造がない場合、グレーレベル共起行列には、優先されるグレーレベルペアの集合は存在しない。このような場合、行列は均一に分布することが期待される。したがって、グレーレベル分布のランダム性を測定する特徴量はエントロピーであり、以下のように定義される。
\[
エントロピー = -\sum_i\sum_j P[i,j]\log P[i,j] \tag{7.1}
\]
\(P[i, j]\) のすべての要素が等しい場合、エントロピーは最大となることに注意。このような行列は、指定された距離ベクトル \(\mathbf d\) に対して優先されるグレーレベルペアが存在しない画像に対応する。エネルギー、コントラスト、均一性といった特徴も、以下に示すグレーレベル共起行列を用いて定義される:
\[
\begin{align}
エネルギー &= \sum_i\sum_j P^2[i,j]\tag{7.2} \\
\\
コントラスト &= \sum_i\sum_j (i-j)^2P[i,j] \tag{7.3} \\
\\
均質性 &= \sum_i\sum_j \frac{P[i,j]}{1+|i-j|}\tag{7.4}
\end{align}
\]
変位ベクトル \(\mathbf d\) の選択は、グレーレベル共起行列の定義において重要なパラメータである。場合によっては、複数の \(\mathbf d\) の値に対して共起行列が計算され、\(P[i, j]\) から計算される統計的尺度が最大となるものが用いられる。グレーレベル共起行列アプローチは、特にマイクロテクスチャーの記述に適している。ただし、形状特性を捉えることができないため、大面積のプリミティブを含むテクスチャーには適していない。グレーレベル共起行列は、土地利用分類のためのリモートセンシングアプリケーションで広く利用されている。
</p><p>
<strong>自己相関</strong><br>
\(N×N\) 画像の自己相関関数 \(p[k, l]\) は次のように定義される:
\[
p[k.l]=\frac{\frac{1}{(N-k)(N-l)}\sum\limits_{i=1}^{(N-k)}\sum\limits_{j=1}^{(N-l)} f[i,j]f[i+k,j+l]}{\frac{1}{N^2}\sum\limits_{i=1}^N\sum\limits_{j=1}^N f^2([i,j]}　0\leq k,l\leq N-1 \tag{7.5}
\]

</p><p>
反復的なテクスチャーパターンを含む画像の場合、自己相関関数は隣接するテクスチャープリミティブ間の間隔に等しい周期的な挙動を示す。テクスチャーが粗い場合、自己相関関数は緩やかに減少するが、細かいテクスチャーの場合は急激に減少する。自己相関関数は、テクスチャーの周期性だけでなく、テクスチャープリミティブのスケールの尺度としても用いられる。
<p>
<h2>7.3 組織的テクスチャーの構造解析</h3>
<p>
テクスチャープリミティブが個別にセグメント化して記述できるほど大きい場合、プリミティブとその配置規則を記述する構造的手法が有用である。例えば、図7.3(a)に示すように、均一なグレーレベル円板を規則的なグリッドパターンに繰り返し配置して形成された単純なテクスチャーを考えてみよう。このようなテクスチャーは、まず前述の連結成分ラベリングなどの単純な手法を用いて円板をセグメント化し、次にこれらの連結成分の重心によって形成される規則的な構造を決定することで記述できる。より一般的な2値画像の場合、まず形態学的手法を用いてプリミティブを抽出し、次にそれらの配置規則を決定できる。このような形態学的手法は、画像がノイズやその他の非反復的なランダムパターンによって破損している場合に特に有用である。これらのパターンは、単純な連結成分ラベリング手法では分離が困難である。例えば、図7.3(a)に示す画像がノイズによって破損し、図7.3(b)に示すようにランダムな線状の縞模様が生じている場合、形態学的手法（第2章参照）を用いてすべての円板の位置を特定できる。
</p>
<center><img src="images/fig7_3.png"></center>
<p>
図 7.3　(a) ディスクを規則的なグリッド上に繰り返し配置して形成された単純なテクスチャー。(b) ランダムな線の縞によって乱れた (a) のテクスチャー。
</p><p>
グレースケール画像の場合、プリミティブに対応する各ブロブ(塊, 領域)内のすべてのピクセルが満たす条件(?predicate)を定義できる。一般的に使用される条件は、グレーレベル均一性条件である。画像は最初にラプラシアン/ガウスフィルタ（第5章参照）を用いて処理される。次に、エッジピクセル上またはエッジピクセル付近にないすべてのピクセルをグループ化することで、プリミティブ領域が識別される。均一なブロブの場合、サイズ、伸長、方向などの特性が有用な特徴となる。これらのプリミティブの空間的関係を分析することで得られる共起性に基づく尺度は、テクスチャーの特性評価に使用される。
<p>
<h2>7.4 テクスチャー解析のためのモデルベース手法</h2>
<p>
テクスチャーを特徴付けるアプローチの一つとして、分析対象となるテクスチャー画像の解析モデルを決定することが挙げられる。このようなモデルには、一連のパラメータがある。これらのパラメータの値はテクスチャーの特性を決定し、モデルを適用することでテクスチャーを合成することができる。テクスチャー解析における課題は、合成されたテクスチャーが分析対象のテクスチャーと視覚的に類似するように、これらのモデルパラメータを推定することである。
</p><p>
マルコフ確率場（MRF）は、テクスチャーのモデルとして広く研究されてきた。離散ガウス・マルコフ確率場モデルでは、任意のピクセルのグレーレベルは、隣接するピクセルのグレーレベルの線形結合と加法的なノイズ項の組み合わせとしてモデル化され、次の式で表される:
</p><p>
\[
f[i,j]=\sum_{k,l} f[i-k,j-l]h[k,l]+n[i,j] \tag{7.6}
\]
ここで、合計はピクセル \([i,j]\) に隣接する指定されたピクセルセットに対して実行される。このモデルのパラメータは重み \(h[k, 1]\) である。これらのパラメータは、最小二乗法を用いて与えられたテクスチャー画像から計算される。そして、これらの推定パラメータを既知のテクスチャークラスのパラメータと比較することで、分析対象のテクスチャークラスが決定される。
</p><p>
テクスチャーを形成するパターンが異なるスケールで自己相似性を持つ場合、フラクタルベースのモデルが用いられる。集合が自己相似性を持つとは、その集合を、それ自身のN個のコピーを \(r\) 倍に縮小した、重複しない和集合として分解できることを意味する。このようなテクスチャーは、フラクタル次元 \(D\) によって特徴付けられ、次式で表される。
\[
D=\frac{\log N}{\log\frac{1}{r}} \tag{7.7}
\]

フラクタル次元はテクスチャーの特徴付けに有用な特徴である。しかし、自然界のテクスチャーは、上記で想定したフラクタルの決定論的な反復モデルに厳密に従うのではなく、統計的な変動を示すため、画像からDを推定するのは非常に困難である。
</p>
<h2>7.5 テクスチャーからの形状復元(Shape from Texture)</h2>
<p>
テクスチャープリミティブのサイズ、形状、密度の変化は、表面の形状と向きを推定する手がかりとなる。これらの変化は、テクスチャーから形状を推定する手法で利用され、2次元画像から3次元情報を復元する。例として、図7.3(a)に示す規則的なテクスチャーを考えてみよう。このテクスチャーは角度αで傾斜しており、表面の上部が下部よりもカメラから遠くなっている。説明を簡単にするために、与えられた水平線上のすべての点がカメラから同じ深さにある（つまり、傾斜がない）と仮定する。これは図7.4(a)に示されている。対応するキャプチャ画像は図7.5に示されている。円盤が楕円として表示されていることに注目してもらいたい。これは、表面が画像平面と平行ではないことを示している。これらの楕円のサイズは、画像平面内の \(y^\prime\) の関数として減少する。言い換えれば、画像平面内の単位面積あたり、画像の上部付近では中心と比較して楕円の数が多くなり、密度勾配が生じる。さらに、アスペクト比（楕円の短径と長径の比）は一定ではなく、アスペクト比の勾配が生じる[36]。これを示すために、まず、楕円の長径と短径を、傾斜角と像面における楕円の位置の関数として表す式を導出する。
</p><p>
円板の直径を \(d\) とする。円板を像の中心に置くと、この円板に対応する像面上の楕円の長径は、透視投影方程式で与えられる。
\[
d_{major}(0,0)=\frac{d\,f}{z} \tag{7.8}
\]
ここで、\(z\) は円板からカメラ中心までの距離、\(f\) はカメラの焦点距離である。この楕円の短径は、透視投影だけでなく、傾斜角 \(a\) による短縮効果によっても影響を受ける。これは次の式で表される。
\[
d_{minor}(0,0)=\frac{d\,f}{z}\cos\alpha \tag{7.9}
\]
したがって、像面中心の楕円のアスペクト比は \(\cos a\) に等しくなる。像面内の同じ水平線上のすべての楕円のアスペクト比は同じになる。
</p><p>
ここで、像面において中心が \((0, y')\)  にある楕円を考えてみよう。この楕円に対応する円板は、図7.4(b)および(c)に示すように光軸に対して角度をなしている。ここで、\(\tan\theta= y^\prime/f\) である。楕円の長径は、式7.8に若干の修正を加えることで与えられる。円板はカメラ中心から距離 \(S\) のところにあるため、\(z\) を \(S\) に置き換える必要がある。図7.4(b)および(c)より、次の式が得られる。
</p>
<center><img src="images/fig7_4.png"></center>
<p>
図7.4　(a) 傾斜したテクスチャー面を持つカメラシステムの3次元表現。(b) (a) の \(y-z\) ビュー。\(x\) 軸が紙面に向かって伸びている点に注意。(c) (a) の \(x-z\) ビュー。\(y\) 軸が紙面から伸びている点に注意。
</p>
<center><img src="images/fig7_5.png"></center>
<p>
<center>図 7.5: 図 7.4 のカメラ システムからキャプチャされた画像</center>
</p><p>
\[
\begin{align}
\frac{S-z}{\tan\alpha}=S\tan\theta \tag{7.10} \\
\\
S(1-\tan\theta\tan\alpha) = z \tag{7.11} \\
\\
S=\frac{z}{1-\tan\theta\tan\alpha} \tag{7.12}
\end{align}
\]
従って
\[
d_{major}(0,y^\prime)=\frac{d\,f}{z}(1-\tan\theta\tan\alpha) \tag{7.13}
\]
\(d_{minor}(0,y^\prime)\) の導出はもう少し複雑である。まず、図7.4(b)から
\[
S_1=\frac{z}{1-\tan\theta_1\tan\alpha} \tag{7.14}
\]
および
\[
S_2=\frac{z}{1-\tan\theta_2\tan\alpha} \tag{7.15}
\]
ここで、円板の直径 \(d\) が非常に小さく、カメラの中心で小さな角度を占めると仮定すると、次のように近似できる。
\[
\theta_1\approx \theta_2\approx \theta \tag{7.16}
\]
従って
\[
\begin{align}
S_1\approx S_2 &\approx S \tag{7.17} \\
\\
&\approx\frac{z}{1-\tan\theta\tan\alpha} \tag{7.18}
\end{align}
\]

図7.4(b)から次のことがわかる。
\[
AC=d\,\cos\alpha \tag{7.19}
\]
しかし、ABの距離を求める必要がある。
</p><p>
　次の関係に注目すると
\[
S_1-S_2=d\,\sin\alpha \tag{7.20}
\]
以下がわかる。
\[
BC=d\,\sin\alpha\tan\theta \tag{7.21}
\]
従って
\[
\begin{align}
AB &= d(\cos\alpha-\sin\alpha\tan\theta) \tag{7.22} \\
\\
&=d\,\cos\alpha(1-\tan\alpha\tan\theta) \tag{7.23}
\end{align}
\]
さて、透視投影により、
\[
\frac{d_{minor}(0,y^\prime)}{f}=\frac{d\,\cos\alpha(1-\tan\alpha\tan\theta)}{\frac{z}{1-\tan\theta\tan\alpha}} \tag{7.24}
\]
したがって、楕円の \((0, y^\prime)\) における短径は次のように与えられる。
\[
d_{minor}(0,y^\prime)=\frac{d\,f}{z}\cos\alpha(1-\tan\theta\tan\alpha)^2 \tag{7.25}
\]
したがって、\(\cos\alpha(1-\tan\theta\tan\alpha)\) で与えられるアスペクト比は \(\theta\) が増加するにつれて減少し、結果としてアスペクト比の勾配が生じる。
</p><p>
　テクスチャープリミティブのサイズ、形状、密度、アスペクト比といった画像平面上の特徴の変化を利用することで、シーンオブジェクトの面方向（そして最終的には3D面形状）を復元できる。しかし、そのためには、画像平面上の各プリミティブを正確に描写する手法が必要である。図で使用した円盤のような単純な2値プリミティブであれば、個々の画像平面プリミティブを計測用にかなり正確にセグメンテーションすることが可能である。しかし、ノイズによって劣化したより複雑なグレーレベルテクスチャーの場合、画像平面上の特徴を正確に推定することは困難である。
</p><p>

